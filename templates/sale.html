<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>BRATEX — Продажа</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>

<div class="card">

    <h1>Продажа</h1>

    {% if error %}
        <div class="error-box">{{ error }}</div>
    {% endif %}

    {% if success %}
        <div class="success-box">{{ success }}</div>
    {% endif %}

    <!-- Сканирование = предпросмотр -->
    <form method="GET" action="/worker/sale">
        <input type="text" name="code" placeholder="Сканируйте или введите код" required autofocus>
        <button type="submit">Показать товар</button>
    </form>

    <!-- Продажа только после подтверждения -->
    {% if found_product %}
    <div style="margin-top:15px;padding:12px;border:1px solid rgba(0,242,195,0.5);border-radius:12px;">
        <strong>Вы собираетесь продать:</strong><br><br>

        <strong>{{ found_product.name }}</strong><br>
        Категория:
        {% if found_product.category == "male" %} Мужское изделие
        {% else %} Женское изделие
        {% endif %}<br>
        Штрихкод: {{ found_product.barcode }}<br>
        Описание: {{ found_product.description }}<br>
        Размер: {{ found_product.size or "-" }}<br>
        Рост: {{ found_product.height or "-" }}<br>
        Остаток: {{ found_product.quantity }}<br><br>

        <form method="POST">
            <input type="hidden" name="code" value="{{ found_product.barcode }}">
            <input type="number" name="quantity" placeholder="Количество" value="1" min="1" required>
            <button type="submit">Продать</button>
        </form>
    </div>
    {% endif %}

    <a href="/worker/sales_history" class="action-btn">История продаж</a>

    <a href="/worker" class="back-btn">← Назад</a>

</div>

<script>
document.addEventListener("DOMContentLoaded", function(){
  const forms = document.querySelectorAll("form");
  forms.forEach(f=>{
    f.addEventListener("keydown", function(e){
      if(e.key === "Enter"){
        e.preventDefault();
        return false;
      }
    });
  });
});
</script>

</body>
</html>
